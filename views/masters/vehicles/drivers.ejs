<%- include("../../includes/header", {pageName : "drivers" }) %>
    <%- include("../../includes/sidebar", {pageName : "drivers" }) %>
        <%- include("../../includes/toolbar", {pageName : "Manage Drivers" , pageHead : "Masters" }) %>


        <div id="kt_app_content_container" class="app-container container-xxl">
            <!--begin::Card-->
            <div class="card card-flush">
                <!--begin::Card header-->
                <div class="card-header mt-6">
                    <!--begin::Card title-->
                    <div class="card-title">
                        <!--begin::Search-->
                        <div class="d-flex align-items-center position-relative my-1 me-5">
                            <i class="ki-duotone ki-magnifier fs-3 position-absolute ms-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <input type="text" data-kt-permissions-table-filter="search"
                                class="form-control form-control-solid w-250px ps-13" placeholder="Search Vehicle Drivers">
                        </div>
                        <!--end::Search-->
                    </div>
                    <!--end::Card title-->
                    <!--begin::Card toolbar-->
                    <div class="card-toolbar">
                        <!--begin::Button-->
                        <button type="button" class="btn btn-light-primary" data-bs-toggle="modal"
                            data-bs-target="#kt_modal_add_permission">
                            <i class="ki-duotone ki-plus-square fs-3">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>Add New Vehicle Owner</button>
                        <!--end::Button-->
                    </div>
                    <!--end::Card toolbar-->
                </div>
                <!--end::Card header-->
                <!--begin::Card body-->
                <div class="card-body pt-0">
                    <!--begin::Table-->
                    <div id="kt_permissions_table_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                        <div class="table-responsive">
                           
                            <table class="table align-middle table-row-dashed fs-6 gy-5 mb-0 dataTable no-footer"
                            id="kt_permissions_table">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
                                    <th class="min-w-125px sorting" tabindex="0"
                                        aria-controls="kt_permissions_table" rowspan="1" colspan="1"
                                        aria-label="Name: activate to sort column ascending"
                                        style="width: 348.75px;">Driver Name</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1"
                                        aria-label="Assigned To" style="width: 233.328px;">Mobile</th>
                                    <th class="min-w-125px sorting" tabindex="0"
                                        aria-controls="kt_permissions_table" rowspan="1" colspan="1"
                                        aria-label="Created Date: activate to sort column ascending"
                                        style="width: 320.859px;">Address</th>
                                        <th class="min-w-125px sorting" tabindex="0"
                                        aria-controls="kt_permissions_table" rowspan="1" colspan="1"
                                        aria-label="Created Date: activate to sort column ascending"
                                        style="width: 320.859px;">License Number</th>
                                        <th class="min-w-125px sorting" tabindex="0"
                                        aria-controls="kt_permissions_table" rowspan="1" colspan="1"
                                        aria-label="Created Date: activate to sort column ascending"
                                        style="width: 320.859px;">License Validity</th>
                                    <th class="text-end min-w-100px sorting_disabled" rowspan="1" colspan="1"
                                        aria-label="Actions" style="width: 259.562px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="fw-semibold text-gray-600">


                                <% data.forEach((data)=> {%> 
                                    <tr data-rowid="" class="odd">
                                        <td>
                                            <%=data.name%>
                                        </td>
                                        <td>
                                            <%=data.mobile%>
                                             </td>
                                             <td><%=data.address%></td>
                                        <td>
                                            <%=data.licenseNumber%>
                                        </td>
                                        <% 
                                        // Assuming data.insuranceValidity is in the format "dd-mm-yyyy"
                                        var dateParts = data.licenseValidity.split("-");
                                        var day = parseInt(dateParts[0], 10);
                                        var month = parseInt(dateParts[1], 10) - 1; // Months are zero-indexed in JavaScript
                                        var year = parseInt(dateParts[2], 10);

                                        // Convert the licenseValidity date string to a JavaScript Date object
                                        var licenseValidityDate = new Date(year, month, day);

                                        const today = new Date();
                                        const sevenDaysAhead = new Date(today);
                                        sevenDaysAhead.setDate(today.getDate() + 7);


                                        // Check if the insurance has expired
                                        var isInsuranceExpired = licenseValidityDate < sevenDaysAhead;
                                        %>
                                       <td>
                                        <% if(isInsuranceExpired) {%> 
                                            <span class="badge badge-light-danger fs-7 m-1"> <%=data.licenseValidity%></span>
                                            <%} else {%> 
                                                <span class="badge badge-light-success fs-7 m-1"> <%=data.licenseValidity%></span>
                                                
                                                <% } %>

                                       </td>
                                        
                                        <td class="text-end">
                                            <!-- Updated "Edit" button -->
                                            <button onclick="editDriver('<%=data.name%>', '<%=data.mobile%>', '<%=data.address%>', '<%=data.licenseNumber%>', '<%=data.licenseValidity%>', '<%=data.id%>')"
                                                class="btn btn-icon btn-active-light-primary w-30px h-30px me-3">
                                                <i class="ki-duotone ki-setting-3 fs-3">
                                                    <span class="path1"></span>
                                                    <span class="path2"></span>
                                                    <span class="path3"></span>
                                                    <span class="path4"></span>
                                                    <span class="path5"></span>
                                                </i>
                                            </button>
    
                                            <button onclick="deleteDriver('<%=data.name%>', '<%=data.id%>')"
                                                class="btn btn-icon btn-active-light-primary w-30px h-30px delete-button"
                                                data-kt-permissions-table-filter="delete_row">
                                                <i class="ki-duotone ki-trash fs-3">
                                                    <span class="path1"></span>
                                                    <span class="path2"></span>
                                                    <span class="path3"></span>
                                                    <span class="path4"></span>
                                                    <span class="path5"></span>
                                                </i>
                                            </button>
                                        </td>
                                    </tr>
                                    <%}) %>
    
    
                               
                            </tbody>
                        </table>
                        </div>

                    </div>
                    <!--end::Table-->
                </div>
                <!--end::Card body-->
            </div>
            <!--end::Card-->
            <!--begin::Modals-->
            <!--begin::Modal - Update permissions-->
            <div class="modal fade" id="kt_modal_update_permission" tabindex="-1" aria-hidden="true">
                <!--begin::Modal dialog-->
                <div class="modal-dialog modal-dialog-centered mw-650px">
                    <!--begin::Modal content-->
                    <div class="modal-content">
                        <!--begin::Modal header-->
                        <div class="modal-header">
                            <!--begin::Modal title-->
                            <h2 class="fw-bold">Update Driver Details</h2>
                            <!--end::Modal title-->
                            <!--begin::Close-->
                            <div class="btn btn-icon btn-sm btn-active-icon-primary"
                                data-kt-permissions-modal-action="close">
                                <i class="ki-duotone ki-cross fs-1">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                            </div>
                            <!--end::Close-->
                        </div>
                        <!--end::Modal header-->
                        <!--begin::Modal body-->
                        <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                            <!--begin::Notice-->

                            <!--end::Notice-->
                            <!--begin::Form-->
                            <form id="editDriver" class="form fv-plugins-bootstrap5 fv-plugins-framework" action="#">
                                <input type="hidden" id="cityID" name="id" value="">
                               
                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Name</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Name" name="name">

                                    <!--end::Input-->
                                </div>
                                
                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Mobile</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Mobile No." name="mobile">

                                    <!--end::Input-->
                                </div>
                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Address</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Address" name="address">

                                    <!--end::Input-->
                                </div>

                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="">License Number</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Licnese Number" name="licenseNumber">

                                    <!--end::Input-->
                                </div>
                                <div class="fv-row mb-7">
                                    <label for="" class="form-label">Driving License Validity</label>
                                    <input name="licenseValidity" class="form-control form-control-solid" placeholder="Pick a date" id="kt_datepicker_2"/>
                                </div>

                                <!--begin::Actions-->
                                <div class="text-center pt-15">
                                    <button type="reset" class="btn btn-light me-3"
                                        data-kt-permissions-modal-action="cancel">Discard</button>
                                    <button type="submit" class="btn btn-primary"
                                        data-kt-permissions-modal-action="submit">
                                        <span class="indicator-label">Submit</span>
                                        <span class="indicator-progress">Please wait...
                                            <span
                                                class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                                    </button>
                                </div>
                                <!--end::Actions-->
                            </form>
                            <!--end::Form-->
                        </div>
                        <!--end::Modal body-->
                    </div>
                    <!--end::Modal content-->
                </div>
                <!--end::Modal dialog-->
            </div>
            <!--end::Modal - Update permissions-->


            <!--begin::Modal - Add permissions-->
            <div class="modal fade" id="kt_modal_add_permission" tabindex="-1" aria-hidden="true">
                <!--begin::Modal dialog-->
                <div class="modal-dialog modal-dialog-centered mw-650px">
                    <!--begin::Modal content-->
                    <div class="modal-content">
                        <!--begin::Modal header-->
                        <div class="modal-header">
                            <!--begin::Modal title-->
                            <h2 class="fw-bold">Add a New Driver</h2>
                            <!--end::Modal title-->
                            <!--begin::Close-->
                            <div class="btn btn-icon btn-sm btn-active-icon-primary"
                                data-kt-permissions-modal-action="close">
                                <i class="ki-duotone ki-cross fs-1">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                            </div>
                            <!--end::Close-->
                        </div>
                        <!--end::Modal header-->
                        <!--begin::Modal body-->
                        <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                            <!--begin::Form-->
                            <form id="newDriver" class="form fv-plugins-bootstrap5 fv-plugins-framework">
                                <!--begin::Input group-->
                               

                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Name</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Name" name="name">

                                    <!--end::Input-->
                                </div>
                                
                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Mobile</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Mobile No." name="mobile">

                                    <!--end::Input-->
                                </div>
                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Driver Address</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Address" name="address">

                                    <!--end::Input-->
                                </div>

                                <div class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="">License Number</span>
                                        <span class="ms-2" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-kt-initialized="1">
                                            <i class="ki-duotone ki-information fs-7">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                                <span class="path3"></span>
                                            </i>
                                        </span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input class="form-control form-control-solid"
                                        placeholder="Enter Driver Licnese Number" name="licenseNumber">

                                    <!--end::Input-->
                                </div>
                                <div class="fv-row mb-7">
                                    <label for="" class="form-label">Driving License Validity</label>
                                    <input name="licenseValidity" class="form-control form-control-solid" placeholder="Pick a date" id="kt_datepicker_3"/>
                                </div>
                                
                                <!--begin::Actions-->
                                <div class="text-center pt-15">
                                    <button type="reset" class="btn btn-light me-3"
                                        data-kt-permissions-modal-action="cancel">Discard</button>
                                    <button type="submit" class="btn btn-primary"
                                        data-kt-permissions-modal-action="submit">
                                        <span class="indicator-label">Submit</span>
                                        <span class="indicator-progress">Please wait...
                                            <span
                                                class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                                    </button>
                                </div>
                                <!--end::Actions-->
                            </form>
                            <!--end::Form-->
                        </div>
                        <!--end::Modal body-->
                    </div>
                    <!--end::Modal content-->
                </div>
                <!--end::Modal dialog-->
            </div>
            <!--end::Modal - Add permissions-->

            <!--end::Modals-->
        </div>



       
            <%- include("../../includes/footer", {pageName : "drivers" }) %>