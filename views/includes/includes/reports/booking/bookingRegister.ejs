<% if(pageName==="bookingRegister" ) {%>
    <script>
        $(document).ready(function () {
            setFinancialYearRangeForReport("<%=financialYear.fy%>");
        })
    </script>
    <script>
        "use strict";

        // Class definition
        var KTDatatablesExample = function () {
            // Shared variables
            var table;
            var datatable;

            // Private functions
            var initDatatable = function () {
                // Set date data order
                const tableRows = table.querySelectorAll('tbody tr');

                tableRows.forEach(row => {
                    const dateRow = row.querySelectorAll('td');
                    const realDate = moment(dateRow[3].innerHTML, "DD MMM YYYY, LT").format(); // select date from 4th column in table
                    dateRow[3].setAttribute('data-order', realDate);
                });

                // Init datatable --- more info on datatables: https://datatables.net/manual/
                datatable = $(table).DataTable({
                    "info": false,
                    'order': [],
                    'pageLength': 10,
                    'scrollX': true, // Set the height of the scrollable area (adjust as needed)
                    'fixedColumns': {
                        leftColumns: 2, // Number of columns to freeze on the left
                    },
                });
            }

            // Hook export buttons
            var exportButtons = () => {
                const documentTitle = 'Lorry Reciept (LR) Report';
                var buttons = new $.fn.dataTable.Buttons(table, {
                    buttons: [
                        {
                            extend: 'copyHtml5',
                            title: documentTitle
                        },
                        {
                            extend: 'excelHtml5',
                            title: documentTitle
                        },
                        {
                            extend: 'csvHtml5',
                            title: documentTitle
                        }
                    ]
                }).container().appendTo($('#kt_datatable_example_buttons'));

                // Hook dropdown menu click event to datatable export buttons
                const exportButtons = document.querySelectorAll('#kt_datatable_example_export_menu [data-kt-export]');
                exportButtons.forEach(exportButton => {
                    exportButton.addEventListener('click', e => {
                        e.preventDefault();

                        // Get clicked export value
                        const exportValue = e.target.getAttribute('data-kt-export');
                        const target = document.querySelector('.dt-buttons .buttons-' + exportValue);

                        // Trigger click event on hidden datatable export buttons
                        target.click();
                    });
                });
            }

            // Search Datatable --- official docs reference: https://datatables.net/reference/api/search()
            var handleSearchDatatable = () => {
                const filterSearch = document.querySelector('[data-kt-filter="search"]');
                filterSearch.addEventListener('keyup', function (e) {
                    datatable.search(e.target.value).draw();
                });
            }

            // Public methods
            return {
                init: function () {
                    table = document.querySelector('#kt_datatable_example');

                    if (!table) {
                        return;
                    }

                    initDatatable();
                    exportButtons();
                    handleSearchDatatable();
                }
            };
        }();



        // On document ready
        KTUtil.onDOMContentLoaded(function () {
            KTDatatablesExample.init();
        });
    </script>


    <script>
        //we will save original branch, godown, city options in local storage
        //so that we can use it in filter


        $(document).ready(function () {
            var originalBranchOptions = $("#fromBranch").html();
            var originalGodownOptions = $("#fromGodown").html();
            var originalCityOptions = $("#fromCity").html();

            localStorage.setItem("originalBranchOptions", originalBranchOptions);
            localStorage.setItem("originalGodownOptions", originalGodownOptions);
            localStorage.setItem("originalCityOptions", originalCityOptions);
        })

    </script>


    <script>
        $("#lrSeries").on("change", function () {
            if ($(this).val() === "all") {
                $("#lrNumberFrom").attr("disabled", true).val(null).select2()
                $("#lrNumberTo").attr("disabled", true).val(null).select2()
            } else {
                $("#lrNumberFrom").attr("disabled", false);
                $("#lrNumberTo").attr("disabled", false);
            }
        })

        $("#fromZone").on("change", function () {
            if ($(this).val() === "all") {
                
                //getting original options from local storage and setting it to select
                var originalBranchOptions = localStorage.getItem("originalBranchOptions");
                var originalGodownOptions = localStorage.getItem("originalGodownOptions");
                var originalCityOptions = localStorage.getItem("originalCityOptions");

                $("#fromBranch").html(originalBranchOptions);
                $("#fromGodown").html(originalGodownOptions);
                $("#fromCity").html(originalCityOptions);

                //reinitializing select2
                $("#fromBranch").val("all").select2();
                $("#fromGodown").val("all").select2();
                $("#fromCity").val("all").select2();

            } else {

                //adding back all again

                //getting original options from local storage and setting it to select
                var originalBranchOptions = localStorage.getItem("originalBranchOptions");
                var originalGodownOptions = localStorage.getItem("originalGodownOptions");
                var originalCityOptions = localStorage.getItem("originalCityOptions");

                $("#fromBranch").html(originalBranchOptions);
                $("#fromGodown").html(originalGodownOptions);
                $("#fromCity").html(originalCityOptions);

                //reinitializing select2
                $("#fromBranch").select2();
                $("#fromGodown").select2();
                $("#fromCity").select2();

                //removing all branch which data-zone attr is not equal to selected zone
                $("#fromBranch option").each(function () {
                    if ($(this).attr("data-zone") != $("#fromZone option:selected").val() && $(this).val() != "all") {
                        $(this).remove();
                    }
                })

                //checking if branch option length is less than 1 or else we will disable it
                if ($("#fromBranch option:not([value='all'])").length < 1) {
                    showError("There are no branches in selected zone")
                    $("#fromBranch").attr("disabled", true).select2();
                    $("#fromGodown").attr("disabled", true).select2();
                    $("#fromCity").attr("disabled", true).select2();
                } else {
                    $("#fromBranch").attr("disabled", false).select2();
                    $("#fromGodown").attr("disabled", false).select2();
                    $("#fromCity").attr("disabled", false).select2();
                }

                

                //reinitializing select2
                $("#fromBranch").val("all").select2();
                $("#fromGodown").val("all").select2();
                $("#fromCity").val("all").select2();

            }
        })


    </script>

    <script>
        $("#fromBranch").on("change", function () {
            if ($(this).val() === "all") {
                //
                $("#fromGodown").attr("disabled", true).val(null).select2()
            } else {

                //adding back all godown again from local storage
                var originalGodownOptions = localStorage.getItem("originalGodownOptions");
                $("#fromGodown").html(originalGodownOptions);
                $("#fromGodown").select2();

                $("#fromGodown").attr("disabled", false);
                
                //removing all godown which data-branch attr is not equal to selected branch
                $("#fromGodown option").each(function () {
                    if ($(this).attr("data-branch") != $("#fromBranch option:selected").val() && $(this).val() != "all") {
                        $(this).remove();
                    }
                })
            }
        })
    </script>
    <script>
        $("#btnSubmit").on("click", function(){
            const form = document.getElementById("bookingRegisterForm");
            //emabling all input and select fields so that they can be submitted
            
            const disabledInputs = form.querySelectorAll("input[disabled], select[disabled]");
            for (const input of disabledInputs) {
                input.setAttribute("disabled", "disabled");
            }

            const data = new URLSearchParams()
            for (const pair of new FormData(form)) {
                data.append(pair[0], pair[1])
            }

            //disabling submitBTN
            // $("#btnSubmit").prop("disabled", true).attr("data-kt-indicator", "on")
            fetchPostRequestAndReturnData("/reports/booking/booking-register", data, $("#btnSubmit"))


        })
    </script>
    <%} %>